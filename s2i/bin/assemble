#!/bin/bash

set -e

cd /tmp/src


java -version
which java
ls -l $(which java)
which mvn
ls -l $(which mvn)
JAVA_HOME='/usr/lib/jvm/java-11-openjdk-amd64'
ls -R $JAVA_HOME


mvn package

mkdir -p /opt/app/tmp

DEFAULT_TARGET='target/app.jar'
if [ -f $DEFAULT_TARGET ]
  then
    cp $DEFAULT_TARGET /opt/app/app.jar
  fi

for f in $(find target -maxdepth 1 -type f -name '*-distribution.tar.gz')
  do
    echo "found tarball '$f'"
    tar -C /opt/app/ -xzvf ./"$f" --strip-components=1
    mv /opt/app/*.jar /opt/app/app.jar
  done

chmod -R 777 /opt/app/

ls -l /opt/app

